{% extends 'base.html' %}
{% load static %}


{% block content %}

    <div class="row">
        <div class="col-xl-3 col-lg-6 col-md-6 col-12">
            <div class="card pull-up">
                <div class="card-content">
                    <div class="card-body">
                        <div class="media d-flex">
                            <div class="align-self-center">
                                {#                                            <i class="la la-edit font-large-2 success"></i>#}
                                <img class="media-object rounded-circle" src="{% static "app-assets/images/cards/anc_referral.png" %}" alt="Avatar">
                            </div>

                            <div class="media-body text-right">
                                <h5 class="text-muted text-bold-500">ANC Referrals</h5>
                                <h3 class="text-bold-600" id="id_card_anc_referral">{{ card_anc_referrals }}</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-12">
            <div class="card pull-up">
                <div class="card-content">
                    <div class="card-body">
                        <div class="media d-flex">
                            <div class="align-self-center">
                                {#                                            <i class="la la-edit font-large-2 success"></i>#}
                                <img class="media-object rounded-circle" src="{% static "app-assets/images/cards/fp_referral.png" %}" alt="Avatar">
                            </div>
                            <div class="media-body text-right">
                                <h5 class="text-muted text-bold-500">Family Planning Referrals</h5>
                                <h3 class="text-bold-600" id="id_card_fp_referrals">{{ card_family_planning_referrals }}</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-12">
            <div class="card pull-up">
                <div class="card-content">
                    <div class="card-body">
                        <div class="media d-flex">
                            <div class="align-self-center">
                                {#                                            <i class="la la-edit font-large-2 success"></i>#}
                                <img class="media-object rounded-circle" src="{% static "app-assets/images/cards/fp_initiations.png" %}" alt="Avatar">
                            </div>
                            <div class="media-body text-right">
                                <h5 class="text-muted text-bold-500">Family Planning Registrations</h5>
                                <h3 class="text-bold-600" id="id_card_fp_initiations">{{ card_family_planning_initiations }}</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-12">
            <div class="card pull-up">
                <div class="card-content">
                    <div class="card-body">
                        <div class="media d-flex">
                            <div class="align-self-center">
                                {#                                            <i class="la la-edit font-large-2 success"></i>#}
                                <img class="media-object rounded-circle" src="{% static "app-assets/images/cards/fp_discontinuations.png" %}" alt="Avatar">
                            </div>
                            <div class="media-body text-right">
                                <h5 class="text-muted text-bold-500">Family Planning Discontinuations</h5>
                                <h3 class="text-bold-600" id="id_card_fp_discontinuations">{{ card_family_planning_discontinuations }}</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="card-body">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">TOTAL NUMBER OF CLIENTS ISSUED FP METHODS BAR GRAPH</h4>
                </div>
                <div id="container_clients_line" class="col-md-12">
                    <div class="loader-wrapper" id="area_spinner">
                        <div class="loader-container">
                            <div class="ball-beat loader-purple">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <div class="row">
        <div class="card-body">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title">TOTAL NUMBER OF FP ITEMS ISSUED BAR GRAPH</h4>
                </div>
                <div id="container_methods_line" class="col-md-12">
                    <div class="loader-wrapper" id="area_spinner">
                        <div class="loader-container">
                            <div class="ball-beat loader-purple">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

{% endblock %}


{% block scripts %}

    <script>

        $(document).ready(function(){

            $("#filter_spinner").hide();

            Highcharts.chart('container_clients_line', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'TOTAL NUMBER OF CLIENTS ISSUED FP METHODS BAR GRAPH'
                },
                xAxis: {
                    categories: [

                        {% for entry in total_clients %}'{{ entry.method_type }} '{% if not forloop.last %}, {% endif %}{% endfor %}
                    ]
                },
                series: [{
                    name: 'Number of Clients',
                    data: [
                        {% for entry in total_clients %}{{ entry.clients }}{% if not forloop.last %}, {% endif %}{% endfor %}
                    ],
                    color: 'DodgerBlue'
                }]


            });

            Highcharts.chart('container_methods_line', {
                chart: {
                    type: 'column'
                },
                title: {
                    text: 'TOTAL NUMBER OF FP COMMODITIES ISSUED BAR GRAPH'
                },
                xAxis: {
                    categories: [

                        {% for entry in total_fp_methods %}'{{ entry.method_type }} '{% if not forloop.last %}, {% endif %}{% endfor %}
                    ]
                },
                series: [{
                    name: 'Number of Items issued',
                    data: [
                        {% for entry in total_fp_methods %}{{ entry.items }}{% if not forloop.last %}, {% endif %}{% endfor %}
                    ],
                    color: 'Olive'
                }]


            });

            $("#btn_filter").on("click", function () {

                $("#filter_spinner").show();

                var date_from = document.getElementById("id_date_from").value;
                var date_to = document.getElementById("id_date_to").value;
                var location_id = document.getElementById("selected_location_id").value;

                var url = "{% url 'filter_dashboard' %}";

                if (date_from == "" || date_to == "" || location_id == "")
                {
                    $("#filter_spinner").hide();
                    swal("Empty Filter(s)!", "One or more filters are missing.", "warning");
                }

                else {

                    if (date_from > date_to)
                    {
                        $("#filter_spinner").hide();

                        swal("Date Error", "Date From greater than Date to", "error");


                    }
                    else

                    {

                        $.ajax({
                            type: "POST",
                            url: url,
                            data: {
                                date_from: date_from, date_to: date_to, location_id: location_id,
                                'csrfmiddlewaretoken': '{{ csrf_token }}'
                            },

                            success: function (data) {

                                data = $.parseJSON(data);

                                var total_clients = data['total_clients'];
                                var total_clients_categories = [];
                                var total_clients_values = [];

                                var total_fp_methods = data['total_fp_methods'];
                                var fp_methods_categories = [];
                                var fp_methods_values = [];

                                $.each(total_clients, function (k, v) {
                                    total_clients_categories.push(v.method_type);
                                    total_clients_values.push(v.clients);
                                });

                                $.each(total_fp_methods, function (k, v) {
                                    fp_methods_categories.push(v.method_type);
                                    fp_methods_values.push(v.items);
                                });

                                $('#id_card_anc_referral').text(data["card_anc_referrals"]);
                                $('#id_card_fp_referrals').text(data["card_family_planning_referrals"]);
                                $('#id_card_fp_initiations').text(data["card_family_planning_initiations"]);
                                $('#id_card_fp_discontinuations').text(data["card_family_planning_discontinuations"]);

                                Highcharts.chart('container_clients_line', {
                                    chart: {
                                        type: 'column'
                                    },
                                    title: {
                                        text: 'NUMBER OF CLIENTS ENROLLED TO FAMILY PLANNING METHODS'
                                    },
                                    xAxis: {
                                        categories: total_clients_categories
                                    },
                                    series: [{
                                        name: 'Number of Clients',
                                        data: total_clients_values,
                                        color: 'DodgerBlue'
                                    }]


                                });

                                Highcharts.chart('container_methods_line', {
                                    chart: {
                                        type: 'column'
                                    },
                                    title: {
                                        text: 'NUMBER OF FAMILY PLANNING ITEMS ISSUED'
                                    },
                                    xAxis: {
                                        categories: fp_methods_categories
                                    },
                                    series: [{
                                        name: 'Number of Items issued',
                                        data: fp_methods_values,
                                        color: 'Olive'
                                    }]


                                });

                                $("#filter_spinner").hide();

                            },
                            error: function (XMLHttpRequest, textStatus, errorThrown) {

                                $("#filter_spinner").hide();

                                swal("Error!", "Operation Failed.", "error");

                            }
                        });

                    }
                }


            })

        });

    </script>

{% endblock %}